{%- extends "pydata_sphinx_theme/layout.html" %}
{%- block extrahead %}
{{ super() }}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<meta name="theme-color" content="#0d1117">
<script>
// Apply saved theme or system preference before paint to avoid flash
(function() {
  var saved = localStorage.getItem('terminal-theme');
  if (saved) {
    document.documentElement.setAttribute('data-theme', saved);
  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', 'light');
  } else {
    document.documentElement.setAttribute('data-theme', 'dark');
  }
})();
</script>
{% endblock %}

{% block docs_body %}
{{ super() }}
<script>
(function() {
  // Insert toggle button into titlebar
  var titlebar = document.querySelector('.terminal-titlebar');
  if (!titlebar) return;

  var btn = document.createElement('button');
  btn.className = 'theme-toggle';
  btn.setAttribute('aria-label', 'Toggle light/dark mode');
  updateLabel();
  titlebar.appendChild(btn);

  btn.addEventListener('click', function() {
    var current = document.documentElement.getAttribute('data-theme');
    var next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('terminal-theme', next);
    // Update meta theme-color
    var meta = document.querySelector('meta[name="theme-color"]');
    if (meta) meta.setAttribute('content', next === 'dark' ? '#0d1117' : '#f6f8fa');
    updateLabel();
  });

  function updateLabel() {
    var theme = document.documentElement.getAttribute('data-theme');
    btn.textContent = theme === 'light' ? '☀ dark/light' : '☾ dark/light';
  }

  // Listen for system preference changes (when no saved preference)
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
    if (!localStorage.getItem('terminal-theme')) {
      var next = e.matches ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      updateLabel();
    }
  });
})();
</script>
{% endblock %}
